var scale_to_use = require('users/emanuelespiritowork/SharedRepo:assets/scale_to_use');

exports.three_bands_image_stretch = function(img,bands){
  var geometry_of_image = img.geometry();
  
  //supposing bands is a list of strings
  img = img.select(bands);
  
  var computed_img_std = img.reduceRegion({
    reducer: ee.Reducer.stdDev(),
    scale: scale_to_use.scale_to_use,
    geometry: geometry_of_image,
    bestEffort: true
  });
  
  var computed_img_mean = img.reduceRegion({
    reducer: ee.Reducer.mean(),
    scale: scale_to_use.scale_to_use,
    geometry: geometry_of_image,
    bestEffort: true
  });
  
  var computed_img_min = ee.Number.expression({
    expression: 'A-2*B',
    vars: {A: computed_img_mean, B: computed_img_std}
  }).getInfo();
  
  var computed_img_max = ee.Number.expression({
    expression: 'A+2*B',
    vars: {A: computed_img_mean, B: computed_img_std}
  }).getInfo();

var vis_specific_image = {
  bands: ['B4','B3','B2'],
  min: [computedB4_min,computedB3_min,computedB2_min],
  max: [computedB4_max,computedB3_max,computedB2_max]
};

Map.addLayer(specific_image,vis_specific_image, 'specific_image',
false);

return 0;
}

