var scale_to_use = require('users/emanuelespiritowork/SharedRepo:assets/scale_to_use');

exports.three_bands_image_stretch = function(img,bands){
  var geometry_of_image = img.geometry();
  
  //supposing bands is a list of strings
  img = img.select(bands);
  
  var computed_img_std = img.reduceRegion({
    reducer: ee.Reducer.stdDev(),
    scale: scale_to_use.scale_to_use,
    geometry: geometry_of_image,
    bestEffort: true
  }).toArray();
  
  print("computed_img_std",computed_img_std);
  
  var computed_img_mean = img.reduceRegion({
    reducer: ee.Reducer.mean(),
    scale: scale_to_use.scale_to_use,
    geometry: geometry_of_image,
    bestEffort: true
  }).toArray();
  
  var array_of_2 = ee.Array(ee.List([2,2,2]));
  
  var computed_img_min = computed_img_mean.subtract(array_of_2.multiply(computed_img_std));
  print("computed_img_min",computed_img_min);
  var computed_img_max = ee.Number.expression({
    expression: 'A+2*B',
    vars: {A: computed_img_mean, B: computed_img_std}
  }).getInfo();

var vis_specific_image = {
  bands: bands,
  min: computed_img_min,
  max: computed_img_max
};

Map.addLayer(img, vis_specific_image, 'img', true);

return 0;
}

