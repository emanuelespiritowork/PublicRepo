exports.time_series_get_plot_ts = function(time_series,which_property){
  var propertyNames = time_series.first().propertyNames();
  
  print(propertyNames);
  var xProperty = ee.Algorithms.If({
      condition: propertyNames.contains('system:time_start'),
      trueCase: 'system:time_start',
      falseCase: ee.Algorithms.If({
      condition: propertyNames.contains('date'),
      trueCase: 'date',
      falseCase: null
    })
    });

  var yProperties;
  if(which_property === undefined || which_property === null)
  {
    yProperties = propertyNames.remove('date')
    .remove('system:time_start')
    .remove('id')
    .remove('system:index')
    .getString(0);
  
  }else{
    yProperties = ee.String(which_property);
  }
  
  print(yProperties);
  
  var p_title = 'Time series of ';
  p_title = ee.String(p_title).cat(ee.String(yProperties));
  
  var plot = ui.Chart.feature.groups({
    features: time_series, 
    xProperty: xProperty.getInfo(),
    yProperty: yProperties.getInfo(),
    seriesProperty: 'id',
  }).setChartType("LineChart")
  .setOptions({
    title: p_title.getInfo(),
    trendlines: {
      0: {
        color: 'CC0000',
      },
      visibleInLegend: 'true',
      type: 'linear'
    },
    linewidth: 1,
    pointsize: 3
  });
  
  return plot;
};