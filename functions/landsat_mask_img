
exports.landsat_mask_img = function(image){
  var qa_pixel_layer = image.select("QA_PIXEL");
  
  var dilated_clouds = 1 << 1;
  var cirrus = 1 << 2;
  var cloud = 1 << 3;
  var cloud_shadow = 1 << 4;
  var snow = 1 << 5;
  
  var dilated_clouds_mask = qa_pixel_layer
  .bitwiseAnd(dilated_clouds).eq(1);
  var cirrus_mask = qa_pixel_layer
  .bitwiseAnd(cirrus).eq(1);
  var cloud_mask = qa_pixel_layer
  .bitwiseAnd(cloud).eq(1);
  var cloud_shadow_mask = qa_pixel_layer
  .bitwiseAnd(cloud_shadow).eq(1);
  var snow_mask = qa_pixel_layer
  .bitwiseAnd(snow).eq(1);
  
  var cloud_confidence_high = 3 << 10;
  var cloud_confidence_medium = 2 << 10;
  var snow_confidence_high = 3 << 12;
  var snow_confidence_medium = 2 << 12;
  
  var cloud_confidence_high_mask = qa_pixel_layer
  .bitwiseAnd(cloud_confidence_high).eq(1);
  
  
  
  
  //Apply masks
  
  return masked_image;
};